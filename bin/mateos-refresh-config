#!/bin/bash

# This script deploys ~/.local/share/mateOS/config/X/Y/Z -> ~/.config/X/Y/Z
config_file=$1

if [[ -z "$config_file" ]]; then
  cat <<USAGE
  Uso: $0 [config_file]

  Debe proporcionar una ruta de archivo desde el directorio .config para actualizarlo.
  Para copiar ~/.local/share/mateOS/config/hypr/hyprlock.conf a ~/.config/hypr/hyprlock.conf
    
    $0 hypr/hyprlock.conf     
USAGE
  exit 1
fi

# Backup the destination file (with timestamp) to avoid clobbering (Ex: hyprlock.conf.bak.1753817951)
user_config_file="${HOME}/.config/$config_file"
default_config_file="${HOME}/.local/share/mateOS/config/$config_file"
backup_config_file="$user_config_file.bak.$(date +%s)"

if [[ -f "$user_config_file" ]]; then
  # Create preliminary backup
  cp -f "$user_config_file" "$backup_config_file" 2>/dev/null

  # Replace config with new default
  cp -f "$default_config_file" "$user_config_file" 2>/dev/null

  # Compare and delete/inform accordingly
  if cmp -s "$user_config_file" "$backup_config_file"; then
    rm "$backup_config_file"
  else
    echo -e "\e[31mReemplazado $user_config_file con el nuevo default de MateOS.\nBackup guardado como ${backup_config_file}.\n\n\e[32mCambios:\e[0m"
    diff "$user_config_file" "$backup_config_file" || true
  fi
else
  # Config file did not exist already
  cp -f "$default_config_file" "$user_config_file" 2>/dev/null
fi

