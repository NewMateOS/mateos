#!/bin/bash

# MateOS Environment Loader
# Cargador autom√°tico de variables de entorno para todos los comandos

MATEOS_PATH="${MATEOS_PATH:-$HOME/.local/share/mateOS}"

# Funci√≥n para cargar variables de entorno
load_mateos_env() {
    # Cargar archivo de variables centralizado
    if [ -f "$MATEOS_PATH/config/mateos-vars.sh" ]; then
        source "$MATEOS_PATH/config/mateos-vars.sh"
        return 0
    else
        echo "‚ùå Archivo de variables no encontrado: $MATEOS_PATH/config/mateos-vars.sh"
        return 1
    fi
}

# Funci√≥n para verificar variables cargadas
check_env_vars() {
    local missing_vars=()
    
    # Variables cr√≠ticas
    local critical_vars=("MATEOS_PATH" "HOME" "USER" "EDITOR" "TERMINAL")
    
    for var in "${critical_vars[@]}"; do
        if [ -z "${!var}" ]; then
            missing_vars+=("$var")
        fi
    done
    
    if [ ${#missing_vars[@]} -eq 0 ]; then
        echo "‚úÖ Todas las variables cr√≠ticas est√°n definidas"
        return 0
    else
        echo "‚ùå Variables faltantes: ${missing_vars[*]}"
        return 1
    fi
}

# Funci√≥n para mostrar variables cargadas
show_env_vars() {
    echo "üìã Variables de entorno de MateOS:"
    echo ""
    
    # Variables principales
    echo "üîß Principales:"
    echo "  MATEOS_PATH: $MATEOS_PATH"
    echo "  HOME: $HOME"
    echo "  USER: $USER"
    echo "  EDITOR: $EDITOR"
    echo "  TERMINAL: $TERMINAL"
    echo ""
    
    # Variables de configuraci√≥n
    echo "‚öôÔ∏è  Configuraci√≥n:"
    echo "  MATEOS_CONFIG_PATH: $MATEOS_CONFIG_PATH"
    echo "  MATEOS_STATE_PATH: $MATEOS_STATE_PATH"
    echo "  MATEOS_LOG_PATH: $MATEOS_LOG_PATH"
    echo ""
    
    # Variables de aplicaciones
    echo "üì± Aplicaciones:"
    echo "  MATEOS_TERMINAL: $MATEOS_TERMINAL"
    echo "  MATEOS_BROWSER: $MATEOS_BROWSER"
    echo "  MATEOS_EDITOR: $MATEOS_EDITOR"
    echo ""
    
    # Variables de temas
    echo "üé® Temas:"
    echo "  MATEOS_DEFAULT_THEME: $MATEOS_DEFAULT_THEME"
    echo "  MATEOS_THEME_AUTO_APPLY: $MATEOS_THEME_AUTO_APPLY"
    echo ""
}

# Funci√≥n para aplicar perfil
apply_profile() {
    local profile="$1"
    
    if [ -z "$profile" ]; then
        echo "Uso: mateos-load-env apply <perfil>"
        echo "Perfiles disponibles: default, development, gaming, server, minimal"
        return 1
    fi
    
    # Cargar variables base
    load_mateos_env
    
    # Aplicar perfil espec√≠fico
    mateos_apply_profile "$profile"
    
    echo "‚úÖ Perfil '$profile' aplicado"
}

# Funci√≥n principal
case "$1" in
    "load")
        load_mateos_env
        ;;
    "check")
        load_mateos_env
        check_env_vars
        ;;
    "show")
        load_mateos_env
        show_env_vars
        ;;
    "apply")
        apply_profile "$2"
        ;;
    "help"|"-h"|"--help")
        echo "üîß MateOS Environment Loader"
        echo ""
        echo "Uso: mateos-load-env <comando> [argumentos]"
        echo ""
        echo "Comandos:"
        echo "  load                    - Cargar variables de entorno"
        echo "  check                   - Verificar variables cr√≠ticas"
        echo "  show                    - Mostrar variables cargadas"
        echo "  apply <perfil>         - Aplicar perfil espec√≠fico"
        echo "  help                    - Mostrar esta ayuda"
        echo ""
        echo "Ejemplos:"
        echo "  mateos-load-env load"
        echo "  mateos-load-env check"
        echo "  mateos-load-env show"
        echo "  mateos-load-env apply development"
        ;;
    *)
        # Cargar variables por defecto
        load_mateos_env
        ;;
esac
