#!/bin/bash

echo "ğŸ” Verificando instalaciÃ³n de MateOS..."
echo ""

ERRORS=0
WARNINGS=0

# Check MATEOS_PATH
if [ -z "$MATEOS_PATH" ]; then
  echo "âŒ MATEOS_PATH no estÃ¡ configurada"
  echo "   SoluciÃ³n: source ~/.config/uwsm/env"
  ((ERRORS++))
else
  echo "âœ… MATEOS_PATH: $MATEOS_PATH"
fi

# Check PATH
if [[ ":$PATH:" != *":$MATEOS_PATH/bin:"* ]]; then
  echo "âŒ MateOS bin no estÃ¡ en PATH"
  ((ERRORS++))
else
  echo "âœ… PATH configurado correctamente"
fi

# Check version file
if [ -f "$MATEOS_PATH/version" ]; then
  VERSION=$(cat "$MATEOS_PATH/version")
  echo "âœ… VersiÃ³n: $VERSION"
else
  echo "âŒ Archivo version no encontrado"
  ((ERRORS++))
fi

# Check scripts
SCRIPT_COUNT=$(ls -1 "$MATEOS_PATH/bin" 2>/dev/null | wc -l)
if [ "$SCRIPT_COUNT" -gt 100 ]; then
  echo "âœ… Scripts: $SCRIPT_COUNT"
else
  echo "âš ï¸  Scripts: $SCRIPT_COUNT (esperados ~118)"
  ((WARNINGS++))
fi

# Check required commands
echo ""
echo "ğŸ”§ Dependencias:"
for cmd in hyprctl kitty waybar gum jq uwsm-app; do
  if command -v $cmd &>/dev/null; then
    echo "  âœ… $cmd"
  else
    echo "  âš ï¸  $cmd (opcional, pero recomendado)"
    ((WARNINGS++))
  fi
done

# Check directories
echo ""
echo "ğŸ“ Directorios:"
for dir in ~/.config/mateos ~/.local/state/mateos; do
  if [ -d "$dir" ]; then
    echo "  âœ… $dir"
  else
    echo "  âš ï¸  $dir (no existe, se crearÃ¡ cuando sea necesario)"
    ((WARNINGS++))
  fi
done

# Summary
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
if [ $ERRORS -eq 0 ]; then
  if [ $WARNINGS -eq 0 ]; then
    echo "âœ… MateOS estÃ¡ correctamente instalado y configurado!"
  else
    echo "âœ… MateOS estÃ¡ funcional (con $WARNINGS advertencias menores)"
  fi
  echo ""
  echo "Prueba ejecutando: mateos-version"
else
  echo "âŒ Se encontraron $ERRORS errores"
  echo ""
  echo "Revisa ~/.local/share/mateOS/SETUP.md para soluciones"
fi
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
